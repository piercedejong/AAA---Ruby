<% content_for :title, "aaa - "+@game.name %>

<div class="nations d-flex">
  <% @game.nations.all.each do |n| %>
    <div id="<%=n.name%>" class="nation mx-auto pl-1 pr-1 shadow-text" style="color:<%=n.color%>;border-radius:0.5rem">
      <div class="nation-name"><%= n.name %></div>
      <div class="money">
        <div id="<%=n.name%>-bank"><%=n.bank%></div>
        <div id="<%=n.name%>-divider">|</div>
        <div id="<%=n.name%>-income"><%=n.total_income%></div>
      </div>
    </div>
  <%end%>
</div>

<div class="container container-game" style="max-width:100%">
  <div class="row">
    <div class="col-sm-8">
      <table class="table table-condensed w-100">
          <thead>
            <tr id="unit-table-top"style="" class="">
              <th class="text-center">Count</th>
              <th class="text-center">Buy</th>
              <th class="text-center">Name</th>
              <th class="text-center">A</th>
              <th class="text-center">D</th>
              <th class="text-center">M</th>
              <% if !current_game.units.first.special.eql? "" %>
                <th class="text-center special">Special Ability</th>
              <%end%>
            </tr>
          </thead>
          <tbody class="unit-table">
            <% current_game.units.each do |u| %>
              <% if u.uid%2 ==  0 %>
                <tr class="tablerow1">
              <% else %>
                <tr class="tablerow2 shadow-text">
              <% end %>
                <td id="<%=u.uid%>" class=" text-center count" style="font-weight:bold"><%= u.count %></td>
                <td class="text-center"><button data-uid="<%=u.uid%>" id="<%=u.name%>" onclick="buy_unit(this)" style="background:<%= u.uid%2==0? current_nation.color : current_nation.colorL %>" class="<%=u.name%> btn btn-unit btn-default btn-block shadow-text" role="button">$<%= u.cost %></button></td>
                <td class="text-center nowrap"><%= u.name %></td>
                <td class="text-center"><%= u.attack %></td>
                <td class="text-center"><%= u.defense %></td>
                <td class="text-center"><%= u.movement %></td>
                <% if !current_game.units.first.special.eql? "" %>
                  <td class="special" style="padding-left:20px;">
                    <div class="d-flex my-auto" style="flex-wrap:wrap;">
                      <% u.specials.each do |s|  %>
                      <div id="" class="unit-tooltip mr-4"><div class="unit-tooltiptext mt-4"><%=s.info%></div><strong><%= s.title %></strong></div>
                      <% end %>
                    </div>
                  </td>
                <% end%>
              </tr>
            <% end %>
          </tbody>
      </table>
    </div>
    <div class="col-sm-1"></div>
    <div class="col-sm-3">
      <div class="d-flex shadow-text">
        <div class="my-auto p-0 mr-1"><button id="change-eco-backward" class="btn-change-eco p-0 my-auto" onclick="change_eco_backward()"><span><i class="fas fa-arrow-circle-left change-eco-card"></i></span></button></div>
        <div id="change-eco" style="background:<%=current_eco.color%>" class="text-center shadow-text mb-2 mt-1"><%=current_eco.name%></div>
        <div class="my-auto p-0 ml-1 "><button id="change-eco-forward" class="btn-change-eco p-0 my-auto" onclick="change_eco_forward()"><span><i class="fas fa-arrow-circle-right change-eco-card"></i></span></button></div>
      </div>
      <table class="w-100 mb-1">
        <tbody>
          <tr class="change">
            <td class="text-center nowrap shadow-text mb-4"><div class="economy-card mr-1 mb-1" id="eco-bank">Bank <%=current_eco.bank%></div></td>
            <td class="text-center nowrap shadow-text mb-4"><div class="economy-card ml-1 mb-1" id="eco-income">Income <%=current_eco.income%></div></td>
          </tr>
          <tr class="change">
            <td><button data-amount="1" onclick="change_bank(this)" style="background:<%=current_eco.color%>" class="change-eco-pos text-center btn-default btn-block btn btn-change shadow-text" role="button">+1</button></td>
            <td><button data-amount="1" onclick="change_income(this)" style="background:<%=current_eco.color%>" class="change-eco-pos text-center btn-default btn-block btn btn-change shadow-text" role="button">+1</button></td>
          </tr>
          <tr class="change">
            <td><button data-amount="-1" onclick="change_bank(this)" style="background:<%=current_eco.colorL%>" class="change-eco-neg text-center btn-default btn-block btn btn-change shadow-text" role="button">-1</button></td>
            <td><button data-amount="-1" onclick="change_income(this)" style="background:<%=current_eco.colorL%>" class="change-eco-neg text-center btn-default btn-block btn btn-change shadow-text" role="button">-1</button></td>
          </tr>
          <tr class="change">
            <td><button data-amount="5" onclick="change_bank(this)" style="background:<%=current_eco.color%>" class="change-eco-pos text-center btn-default btn-block btn btn-change shadow-text" role="button">+5</button></td>
            <td><button data-amount="5" onclick="change_income(this)" style="background:<%=current_eco.color%>" class="change-eco-pos text-center btn-default btn-block btn btn-change shadow-text" role="button">+5</button></td>
          </tr>
          <tr class="change">
            <td><button data-amount="-5" onclick="change_bank(this)" style="background:<%=current_eco.colorL%>" class="change-eco-neg text-center btn-default btn-block btn btn-change shadow-text" role="button">-5</button></td>
            <td><button data-amount="-5" onclick="change_income(this)" style="background:<%=current_eco.colorL%>" class="change-eco-neg text-center btn-default btn-block btn btn-change shadow-text" role="button">-5</button></td>
          </tr>
          <tr class="change">
            <td><button data-amount="10" onclick="change_bank(this)" style="background:<%=current_eco.color%>" class="change-eco-pos text-center btn-default btn-block btn btn-change shadow-text" role="button">+10</button></td>
            <td><button data-amount="10" onclick="change_income(this)" style="background:<%=current_eco.color%>" class="change-eco-pos text-center btn-default btn-block btn btn-change shadow-text" role="button">+10</button></td>
          </tr>
          <tr class="change">
            <td><button data-amount="-10" onclick="change_bank(this)" style="background:<%=current_eco.colorL%>" class="change-eco-neg text-center btn-default btn-block btn btn-change shadow-text" role="button">-10</button></td>
            <td><button data-amount="-10" onclick="change_income(this)" style="background:<%=current_eco.colorL%>" class="change-eco-neg text-center btn-default btn-block btn btn-change shadow-text" role="button">-10</button></td>
          </tr>
        </tbody>
      </table>
      <div class="mt-4">
        <% if is_1940_game%>
          <%= link_to "National Objectives", nation_path(current_eco.uuid), id: "objective", class:"btn btn-default btn-side btn-block ", role: "button", x:"background:"+current_eco.color %>
          <%= link_to "Research and Development", research_path(current_game.uuid), id: "research", class:"btn btn-default btn-side btn-block ", role: "button", x: "background:"+current_eco.color %>
        <%end%>
        <%if is_victories_game%>
          <%= link_to "Victory Objectives", victory_path(current_game.uuid), id: "victory", class:"btn btn-default btn-change btn-side btn-block ", role: "button", x:"background:"+current_eco.color %>
        <%end%>
      </div>
    </div>
  </div>
</div>

<div id="bottom-row" class="pb-1 d-flex bottom-aligned w-100">
  <div class="pl-1 mt-auto">
      <%= link_to "Exit", root_path, class:"btn btn-default btn-back shadow-text", role:"button" %>
  </div>
  <div id="c-nation-body" class="d-flex mt-auto mx-auto pb-1">
    <button id="reset-buy" class="btn btn-default btn-reset-buy my-auto" onclick="reset_buy()" role="button">Reset Buy</button>
    <div id="c-nation-card" class="d-flex c-nation" style="background-color:<%=current_nation.colorL%>">
      <%=image_tag current_nation.roundel , id:"roundel", class:"my-auto"%>
      <div id="c-nation" class="nation shadow-text text-center my-auto" style="color:<%=current_nation.color%>"><%=current_nation.name%>-<%=current_nation.bank%></div>
    </div>
  </div>
  <div class="pr-1 mt-auto">
    <button id="pacific" onclick="buy_pacific()" class="btn btn-default btn-pacific shadow-text" role="button" style="<%=display_buy_pacific%>">Buy Pacific Units</button>
    <button id="end-turn" class="btn btn-default btn-end-turn shadow-text" onclick="end_turn()" style="background:<%=current_nation.color%>; <%=display_end_turn%>" role="button">End Turn</button>
  </div>
</div>


<script>
  var name = "<%= current_nation.name %>"
  $(document).ready(c_nation_opacity(name));
  $(document).ready(game_padding_resize());
  <%current_nation.researches.all.each do |r| %>
  <%  if ["Mass Production", "Improved Shipyards"].include? r.name and r.enabled%>
      $(document).ready(cheap(true));
    <%end%>
  <%end %>
  $(window).resize(function () {
    game_padding_resize();
  });
</script>
